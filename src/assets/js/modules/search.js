(()=>{const i=document.querySelector('#search-input');const p=document.querySelector('#search-panel');if(!i||!p)return;let x=null,docs=[];const r=items=>{p.innerHTML=items.map(it=>`<li><a href="${it.url}">${it.title}</a><span class="muted"> Â· ${it.date}</span></li>`).join('')};i.addEventListener('focus',async()=>{if(x)return;const res=await fetch(`${document.documentElement.dataset.base}search-index.json`);const data=await res.json();docs=data;x=elasticlunr(function(){ this.setRef('id'); this.addField('title'); this.addField('summary'); this.addField('content'); data.forEach((d,i)=>this.add({...d,id:i})) });});i.addEventListener('input',e=>{if(!x)return;const q=e.target.value.trim();if(!q){p.innerHTML='';return;}const result=x.search(q,{bool:'OR',expand:true}).slice(0,8).map(r=>docs[r.ref]);r(result);});document.addEventListener('click',e=>{ if(!p.contains(e.target) && e.target!==i){ p.innerHTML=''; } });})();